<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard RH - Análise por Equipas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/7.8.3/simple-statistics.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .dashboard {
            padding: 30px;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        select, button {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        select:focus, button:hover {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 1px solid #eee;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.3em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .chart-container {
            height: 350px;
            margin-top: 15px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
        }
        
        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }
        
        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .kpi-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .trend {
            margin-top: 10px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .trend.up {
            color: #27ae60;
        }
        
        .trend.down {
            color: #e74c3c;
        }
        
        .trend.neutral {
            color: #f39c12;
        }
        
        .comparison-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .comparison-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Dashboard de Recursos Humanos</h1>
            <p>Análise por Equipas vs Perfil Médio da Empresa - LSIS1 2024/2025</p>
        </div>
        
        <div class="dashboard">
            <div class="controls">
                <div class="control-group">
                    <label for="equipaSelect">Selecionar Equipa:</label>
                    <select id="equipaSelect">
                        <option value="todas">Todas as Equipas</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="marketing">Marketing</option>
                        <option value="vendas">Vendas</option>
                        <option value="rh">Recursos Humanos</option>
                        <option value="financeiro">Financeiro</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="periodoSelect">Período:</label>
                    <select id="periodoSelect">
                        <option value="atual">Atual</option>
                        <option value="trimestre">Último Trimestre</option>
                        <option value="ano">Último Ano</option>
                    </select>
                </div>
                <button onclick="atualizarDashboard()">Atualizar Dashboard</button>
                <button onclick="gerarRelatorio()">Gerar Relatório</button>
            </div>
            
            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Idade Média</div>
                    <div class="kpi-value" id="kpiIdade">32.5</div>
                    <div class="trend up">↗ +0.8 anos</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Tempo Médio na Empresa</div>
                    <div class="kpi-value" id="kpiTempo">4.2</div>
                    <div class="trend up">↗ +0.3 anos</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Remuneração Média</div>
                    <div class="kpi-value" id="kpiRemuneracao">€2,850</div>
                    <div class="trend up">↗ +5.2%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Taxa de Retenção</div>
                    <div class="kpi-value" id="kpiRetencao">89.3%</div>
                    <div class="trend down">↘ -2.1%</div>
                </div>
            </div>
            
            <!-- Charts Grid -->
            <div class="grid">
                <div class="card">
                    <h3>Distribuição por Nível Hierárquico</h3>
                    <div id="chartNivelHierarquico" class="chart-container"></div>
                </div>
                
                <div class="card">
                    <h3>Distribuição por Género</h3>
                    <div id="chartGenero" class="chart-container"></div>
                </div>
                
                <div class="card">
                    <h3>Distribuição por Função</h3>
                    <div id="chartFuncao" class="chart-container"></div>
                </div>
                
                <div class="card">
                    <h3>Distribuição Geográfica</h3>
                    <div id="chartGeografico" class="chart-container"></div>
                </div>
                
                <div class="card">
                    <h3>Tendência de Idade Média</h3>
                    <div id="chartIdadeTendencia" class="chart-container"></div>
                </div>
                
                <div class="card">
                    <h3>Taxa de Retenção ao Longo do Tempo</h3>
                    <div id="chartRetencao" class="chart-container"></div>
                </div>
            </div>
            
            <!-- Comparison Section -->
            <div class="comparison-section">
                <h2>Comparação com Perfil Médio da Empresa</h2>
                <div class="grid">
                    <div class="card">
                        <h3>Idade Média vs Empresa</h3>
                        <div id="chartComparacaoIdade" class="chart-container"></div>
                    </div>
                    
                    <div class="card">
                        <h3>Remuneração vs Empresa</h3>
                        <div id="chartComparacaoRemuneracao" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Dados simulados baseados no documento
        const dadosEquipas = {
            desenvolvimento: {
                idadeMedia: 29.3,
                tempoMedio: 3.8,
                remuneracaoMedia: 3200,
                taxaRetencao: 92.1,
                nivelHierarquico: [
                    {label: "Júnior", y: 45},
                    {label: "Pleno", y: 35},
                    {label: "Sénior", y: 20}
                ],
                genero: [
                    {label: "Masculino", y: 65},
                    {label: "Feminino", y: 32},
                    {label: "Outro", y: 3}
                ],
                funcao: [
                    {label: "Programador", y: 50},
                    {label: "Analista", y: 25},
                    {label: "Arquiteto", y: 15},
                    {label: "DevOps", y: 10}
                ],
                geografico: [
                    {label: "Porto", y: 60},
                    {label: "Lisboa", y: 25},
                    {label: "Braga", y: 10},
                    {label: "Aveiro", y: 5}
                ]
            },
            marketing: {
                idadeMedia: 31.8,
                tempoMedio: 4.1,
                remuneracaoMedia: 2650,
                taxaRetencao: 87.4,
                nivelHierarquico: [
                    {label: "Júnior", y: 40},
                    {label: "Pleno", y: 40},
                    {label: "Sénior", y: 20}
                ],
                genero: [
                    {label: "Masculino", y: 35},
                    {label: "Feminino", y: 62},
                    {label: "Outro", y: 3}
                ],
                funcao: [
                    {label: "Especialista Marketing", y: 40},
                    {label: "Designer", y: 30},
                    {label: "Copywriter", y: 20},
                    {label: "Social Media", y: 10}
                ],
                geografico: [
                    {label: "Lisboa", y: 70},
                    {label: "Porto", y: 20},
                    {label: "Coimbra", y: 10}
                ]
            },
            vendas: {
                idadeMedia: 35.2,
                tempoMedio: 5.3,
                remuneracaoMedia: 2900,
                taxaRetencao: 83.7,
                nivelHierarquico: [
                    {label: "Júnior", y: 30},
                    {label: "Pleno", y: 45},
                    {label: "Sénior", y: 25}
                ],
                genero: [
                    {label: "Masculino", y: 55},
                    {label: "Feminino", y: 43},
                    {label: "Outro", y: 2}
                ],
                funcao: [
                    {label: "Vendedor", y: 60},
                    {label: "Account Manager", y: 25},
                    {label: "Sales Manager", y: 15}
                ],
                geografico: [
                    {label: "Lisboa", y: 50},
                    {label: "Porto", y: 30},
                    {label: "Faro", y: 20}
                ]
            },
            rh: {
                idadeMedia: 38.1,
                tempoMedio: 6.2,
                remuneracaoMedia: 2750,
                taxaRetencao: 95.2,
                nivelHierarquico: [
                    {label: "Júnior", y: 25},
                    {label: "Pleno", y: 50},
                    {label: "Sénior", y: 25}
                ],
                genero: [
                    {label: "Masculino", y: 25},
                    {label: "Feminino", y: 72},
                    {label: "Outro", y: 3}
                ],
                funcao: [
                    {label: "Generalista RH", y: 40},
                    {label: "Recrutador", y: 30},
                    {label: "Especialista Formação", y: 30}
                ],
                geografico: [
                    {label: "Porto", y: 80},
                    {label: "Lisboa", y: 20}
                ]
            },
            financeiro: {
                idadeMedia: 42.3,
                tempoMedio: 7.8,
                remuneracaoMedia: 3100,
                taxaRetencao: 91.8,
                nivelHierarquico: [
                    {label: "Júnior", y: 20},
                    {label: "Pleno", y: 45},
                    {label: "Sénior", y: 35}
                ],
                genero: [
                    {label: "Masculino", y: 48},
                    {label: "Feminino", y: 50},
                    {label: "Outro", y: 2}
                ],
                funcao: [
                    {label: "Contabilista", y: 45},
                    {label: "Analista Financeiro", y: 35},
                    {label: "Controller", y: 20}
                ],
                geografico: [
                    {label: "Lisboa", y: 60},
                    {label: "Porto", y: 40}
                ]
            }
        };
        
        // Perfil médio da empresa
        const perfilMedioEmpresa = {
            idadeMedia: 33.8,
            tempoMedio: 5.1,
            remuneracaoMedia: 2890,
            taxaRetencao: 89.6
        };
        
        // Dados históricos para tendências
        const dadosHistoricos = {
            idadeMedia: [
                {x: new Date(2024, 0), y: 32.1},
                {x: new Date(2024, 1), y: 32.3},
                {x: new Date(2024, 2), y: 32.0},
                {x: new Date(2024, 3), y: 32.5},
                {x: new Date(2024, 4), y: 32.8},
                {x: new Date(2024, 5), y: 32.5}
            ],
            retencao: [
                {x: new Date(2024, 0), y: 91.2},
                {x: new Date(2024, 1), y: 90.8},
                {x: new Date(2024, 2), y: 89.5},
                {x: new Date(2024, 3), y: 90.1},
                {x: new Date(2024, 4), y: 89.7},
                {x: new Date(2024, 5), y: 89.3}
            ]
        };
        
        let chartsInstances = {};
        
        function criarGraficoPizza(containerId, dados, titulo) {
            if (chartsInstances[containerId]) {
                chartsInstances[containerId].destroy();
            }
            
            chartsInstances[containerId] = new CanvasJS.Chart(containerId, {
                animationEnabled: true,
                theme: "light2",
                title: {
                    text: titulo,
                    fontSize: 16
                },
                data: [{
                    type: "pie",
                    startAngle: 240,
                    yValueFormatString: "##0.0\"%\"",
                    indexLabel: "{label} {y}%",
                    dataPoints: dados
                }],
                backgroundColor: "transparent"
            });
            chartsInstances[containerId].render();
        }
        
        function criarGraficoLinha(containerId, dados, titulo, formatoY = "#,##0.0") {
            if (chartsInstances[containerId]) {
                chartsInstances[containerId].destroy();
            }
            
            chartsInstances[containerId] = new CanvasJS.Chart(containerId, {
                animationEnabled: true,
                theme: "light2",
                title: {
                    text: titulo,
                    fontSize: 16
                },
                axisY: {
                    valueFormatString: formatoY
                },
                data: [{
                    type: "line",
                    markerSize: 8,
                    dataPoints: dados
                }],
                backgroundColor: "transparent"
            });
            chartsInstances[containerId].render();
        }
        
        function criarGraficoBarras(containerId, dados, titulo) {
            if (chartsInstances[containerId]) {
                chartsInstances[containerId].destroy();
            }
            
            chartsInstances[containerId] = new CanvasJS.Chart(containerId, {
                animationEnabled: true,
                theme: "light2",
                title: {
                    text: titulo,
                    fontSize: 16
                },
                data: [{
                    type: "column",
                    dataPoints: dados
                }],
                backgroundColor: "transparent"
            });
            chartsInstances[containerId].render();
        }
        
        function atualizarKPIs(equipa) {
            const dados = equipa === 'todas' ? calcularMediaTodas() : dadosEquipas[equipa];
            
            document.getElementById('kpiIdade').textContent = dados.idadeMedia.toFixed(1);
            document.getElementById('kpiTempo').textContent = dados.tempoMedio.toFixed(1);
            document.getElementById('kpiRemuneracao').textContent = `€${dados.remuneracaoMedia.toLocaleString()}`;
            document.getElementById('kpiRetencao').textContent = `${dados.taxaRetencao.toFixed(1)}%`;
        }
        
        function calcularMediaTodas() {
            const equipas = Object.keys(dadosEquipas);
            const totalEquipas = equipas.length;
            
            return {
                idadeMedia: ss.mean(equipas.map(e => dadosEquipas[e].idadeMedia)),
                tempoMedio: ss.mean(equipas.map(e => dadosEquipas[e].tempoMedio)),
                remuneracaoMedia: ss.mean(equipas.map(e => dadosEquipas[e].remuneracaoMedia)),
                taxaRetencao: ss.mean(equipas.map(e => dadosEquipas[e].taxaRetencao)),
                nivelHierarquico: [
                    {label: "Júnior", y: 32},
                    {label: "Pleno", y: 43},
                    {label: "Sénior", y: 25}
                ],
                genero: [
                    {label: "Masculino", y: 46},
                    {label: "Feminino", y: 52},
                    {label: "Outro", y: 2}
                ],
                funcao: [
                    {label: "Técnico", y: 40},
                    {label: "Especialista", y: 35},
                    {label: "Gestor", y: 25}
                ],
                geografico: [
                    {label: "Porto", y: 45},
                    {label: "Lisboa", y: 40},
                    {label: "Outros", y: 15}
                ]
            };
        }
        
        function atualizarDashboard() {
            const equipaSelecionada = document.getElementById('equipaSelect').value;
            const dados = equipaSelecionada === 'todas' ? calcularMediaTodas() : dadosEquipas[equipaSelecionada];
            
            // Atualizar KPIs
            atualizarKPIs(equipaSelecionada);
            
            // Atualizar gráficos
            criarGraficoPizza("chartNivelHierarquico", dados.nivelHierarquico, "Distribuição por Nível Hierárquico");
            criarGraficoPizza("chartGenero", dados.genero, "Distribuição por Género");
            criarGraficoPizza("chartFuncao", dados.funcao, "Distribuição por Função");
            criarGraficoPizza("chartGeografico", dados.geografico, "Distribuição Geográfica");
            
            // Gráficos de tendência
            criarGraficoLinha("chartIdadeTendencia", dadosHistoricos.idadeMedia, "Evolução da Idade Média");
            criarGraficoLinha("chartRetencao", dadosHistoricos.retencao, "Evolução da Taxa de Retenção", "#,##0.0\"%\"");
            
            // Gráficos de comparação
            const dadosComparacaoIdade = [
                {label: equipaSelecionada === 'todas' ? "Média Geral" : equipaSelecionada.charAt(0).toUpperCase() + equipaSelecionada.slice(1), y: dados.idadeMedia},
                {label: "Empresa", y: perfilMedioEmpresa.idadeMedia}
            ];
            
            const dadosComparacaoRemuneracao = [
                {label: equipaSelecionada === 'todas' ? "Média Geral" : equipaSelecionada.charAt(0).toUpperCase() + equipaSelecionada.slice(1), y: dados.remuneracaoMedia},
                {label: "Empresa", y: perfilMedioEmpresa.remuneracaoMedia}
            ];
            
            criarGraficoBarras("chartComparacaoIdade", dadosComparacaoIdade, "Comparação de Idade Média");
            criarGraficoBarras("chartComparacaoRemuneracao", dadosComparacaoRemuneracao, "Comparação de Remuneração");
        }
        
        function gerarRelatorio() {
            const equipaSelecionada = document.getElementById('equipaSelect').value;
            const dados = equipaSelecionada === 'todas' ? calcularMediaTodas() : dadosEquipas[equipaSelecionada];
            
            // Cálculos estatísticos usando simple-statistics
            const desvioIdade = 3.2; // Simulado
            const mediana = ss.median([dados.idadeMedia, perfilMedioEmpresa.idadeMedia]);
            
            alert(`
RELATÓRIO ESTATÍSTICO - ${equipaSelecionada.toUpperCase()}

Indicadores Principais:
- Idade Média: ${dados.idadeMedia.toFixed(1)} anos
- Tempo Médio na Empresa: ${dados.tempoMedio.toFixed(1)} anos
- Remuneração Média: €${dados.remuneracaoMedia.toLocaleString()}
- Taxa de Retenção: ${dados.taxaRetencao.toFixed(1)}%

Comparação com Empresa:
- Diferença Idade: ${(dados.idadeMedia - perfilMedioEmpresa.idadeMedia).toFixed(1)} anos
- Diferença Remuneração: €${(dados.remuneracaoMedia - perfilMedioEmpresa.remuneracaoMedia).toLocaleString()}
- Diferença Retenção: ${(dados.taxaRetencao - perfilMedioEmpresa.taxaRetencao).toFixed(1)}%

Análise Estatística:
- Mediana comparativa: ${mediana.toFixed(1)}
- Desvio padrão estimado: ${desvioIdade.toFixed(1)}
            `);
        }
        
        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            atualizarDashboard();
        });
        
        // Event listeners
        document.getElementById('equipaSelect').addEventListener('change', atualizarDashboard);
        document.getElementById('periodoSelect').addEventListener('change', atualizarDashboard);
    </script>
</body>
</html>